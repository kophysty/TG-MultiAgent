# DevOps - подводные камни и как не делать

Этот документ - накопительная база негативного опыта: что уже ломалось, почему, и как не повторять.

## JS regex: не использовать word boundary для кириллицы

### Симптомы

- Бот "не понимает" русские формулировки, хотя слова явно присутствуют в тексте.
- Интент-детекторы на ключевых словах не срабатывают (например, дневник, запись, сегодня, завтра).
- Поведение плавает: одна и та же фраза то срабатывает, то нет.

### Причина

В JavaScript word boundary (backslash-b) опирается на понятие "word char" (backslash-w), а оно по умолчанию ASCII-only.
Кириллица не считается word char, поэтому границы слова для русских слов определяются неправильно.

### Как правильно

- Для русских ключевых слов:
  - использовать простые проверки `includes` по `lowercase` строке, или
  - использовать regex без word boundary, или
  - использовать Unicode-aware границы на `\\p{L}` и `\\p{N}` (с флагом `u`), если реально нужна точность.
- Для слов, где есть пересечения (например, "послезавтра" содержит "завтра"):
  - важен порядок проверок: сначала длинное, потом короткое.

### Где уже починено

- `core/dialogs/todo_bot.js` и `core/dialogs/todo_bot_helpers.js`:
  - journal intent детекторы
  - распознавание "сегодня/завтра/послезавтра"
  - эвристики для списков и части journal inference


