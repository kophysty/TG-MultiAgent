# N8N (осторожная интеграция)

## Роль N8N

N8N - это "оркестратор проводов", а не мозг бота. Он отвечает за:

- приём и маршрутизацию событий (вебхуки, кроны) и вызов наших внутренних endpoint-ов
- коннекторы внешних сервисов (Notion, Google Calendar, Email, Search и т.д.)
- визуализацию ветвлений и быстрые эксперименты (временные ветки, которые не жалко удалить)
- операционные сценарии (nightly sync, reindex, отчёты, админские джобы)

## Что НЕ делаем в N8N (чтобы его можно было легко отключить)

- не храним состояние диалога (draft tasks, "ждём выбор даты или категории", таймауты)
- не реализуем FSM клавиатур и уточнений внутри нод
- не держим Tool Registry и политики безопасности внутри n8n
- не складываем критичную бизнес-логику в Code nodes

## Контракт, который позволит "выключить" N8N

Единая точка входа в core:

- `POST /events/telegram` (или `/webhooks/telegram`) - принимает Telegram update

`core` сам:

- делает нормализацию
- роутит intent
- ведёт диалог (FSM)
- вызывает инструменты (Notion/MCP, STT и т.д.)
- отвечает в Telegram (или возвращает структуру ответа)

Схема:

- Если N8N нужен: Telegram -> N8N -> `bot-core`
- Если N8N убираем: Telegram -> `bot-core` напрямую

## Где живут "агенты с промптами"

- N8N может вызывать отдельных "обученных" агентов (по промпту) как внешние блоки.
- Но решения о когда и какого агента звать остаются в core (Router, Planner, Policies).


