# Разделение обязанностей (Core vs N8N vs Workers)

## Core (наш код, "мозг")

Отвечает за:

- нормализацию Telegram update -> внутренний event
- диалоги и FSM (draft tasks, шаги выбора: категория, приоритет, дата)
- Intent Router / Planner / Policies (безопасность, подтверждения, low-confidence)
- Tool Registry и детерминированный Executor (ретраи, таймауты, логирование)
- единый API-контракт (чтобы N8N был опционален)

## N8N (оркестрация интеграций)

Отвечает за:

- вызов core endpoint-ов и внешних сервисов как "проводка"
- быстрые интеграционные эксперименты (без критичных состояний)
- cron и операционные потоки (sync, reindex, отчёты)

## Worker (фоновые процессы)

Отвечает за:

- тяжёлые и долгие задачи: STT, sync, индексация, рассылки и напоминания
- очереди и повторные попытки

## Хранилища

- **Postgres**: `conversation_state`, `draft_tasks`, `jobs`, `dedupe`, `memory/preferences`, индекс документов
- **Notion**: первоисточник задач, идей и документов (витрина и ручное редактирование)


