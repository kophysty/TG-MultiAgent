# Text и Voice пайплайны

## Text Pipeline

Взять основу из прошлой версии бота:

- [kophysty/my-ai-1](https://github.com/kophysty/my-ai-1)
- [kophysty/TG_agent_v2](https://github.com/kophysty/TG_agent_v2)

## Voice-пайплайн (как будет работать)

STT - это tool, и агент решает, когда его вызывать.

### Принцип

- статусы - не "стриминг речи", а **прогресс пайплайна** через `editMessageText`
- на входе voice -> быстрый статус ("скачиваю", "конвертирую", "распознаю", "формирую задачу")

### Поток

1. ты отправляешь voice в Telegram
2. бот получает `file_id` -> скачивает OGG/OPUS
3. на VPS конвертируем через ffmpeg в wav 16kHz mono PCM
4. отдаём на транскрипцию (варианты):
   - облачный STT (быстрее): OpenRouter с моделью для транскрибации (подобрать оптимальную)
5. получаем текст -> LLM "парсер" делает структуру задачи:
   - `title / body / due_date / section / repeat / confidence / missing_fields`
6. если чего-то не хватает - бот задаёт вопросы (кнопками), как в текстовом пайплайне
7. если ты не ответил - задача уходит в Inbox "needs triage"
8. создаём или обновляем запись в Notion

Ключ: ffmpeg - это не "библиотека", а готовый бинарник, который мы кладём в Docker образ и вызываем.


