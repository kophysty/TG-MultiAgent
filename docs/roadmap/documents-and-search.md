# Документы, индексация, поиск, цитаты

## Следующий этап: хранение и сводки из документов

### Рекомендованная реализация (минимально и мощно)

#### 1) Документы храним в Notion (или просто ссылкой на файл)

- Страница "Документы" (DB): название, тип (договор, политика, инвойс), теги, дата, контрагент, ссылка на файл или страницу, версия.

#### 2) Индексация на VPS в Postgres

В Postgres храним не "всю Notion структуру", а **текстовые чанки** + метаданные.

Таблицы:

- `documents`:
  - `doc_id`, `notion_page_id`, `title`, `type`, `tags`, `version`, `source_url`
- `doc_chunks`:
  - `chunk_id`, `doc_id`, `chunk_text`, `page/section`, `offset`
  - FTS индекс (полнотекст)
  - (опционально) embedding через `pgvector` для семантического поиска

#### 3) Поиск: гибридный

- сначала быстрый FTS (по словам и терминам)
- потом vector search (по смыслу)
- потом re-rank (если нужно) и сбор 2-6 самых релевантных фрагментов

#### 4) Ответ бота с "цитатами"

Бот возвращает:

- короткий вывод
- выдержки (не огромными простынями)
- ссылки: документ + страница или секция (чтобы ты мог проверить)

## Практичный выбор "где хранить"

1. Notion как библиотека + Postgres индекс (лучший баланс)
2. Если документы очень чувствительные: файл хранить на VPS или в приватном бакете, а в Notion хранить только карточку + ссылку или метаданные; индекс всё равно в Postgres

## Как это встраивается в агентную оркестрацию

Добавляешь инструменты:

- `docs.ingest_from_notion(page_id)`
- `docs.search(query, filters)`
- `docs.quote(chunk_ids)`
- `docs.answer_with_citations(query)`

И роутер начинает отличать "вопрос по документам" от "задачи".


