# AI (текущая реализация)

Этот раздел описывает, что реально умеет AI в текущей версии бота.

## Что AI делает

- Определяет тип сообщения:
  - **вопрос** - отвечает прямо в чат
  - **задача** - извлекает поля задачи, показывает summary и просит подтверждение

## Подтверждение и корректировки

После того как бот показал summary задачи:

- Подтвердить можно:
  - кнопкой **Подтвердить**
  - текстом: **"да"**, **"подтверждаю"**, **"подтвердить"**, **"ок"**
- Отменить можно:
  - кнопкой **Отмена**
  - текстом: **"нет"**, **"отмена"**, **"отменить"**
- Любой другой текст считается уточнением: бот пересобирает черновик задачи и снова просит подтверждение.

## Категории (Tags) и ограничения

- Категории берутся **динамически** из Notion свойства **`Tags`** (options).
- AI **не имеет права** придумывать новые категории:
  - в prompt передается список допустимых категорий
  - если AI сомневается - выбирает **`Inbox`**
- `Deprecated`:
  - AI не выбирает эту категорию
- Алиас `Today`:
  - в UI может отображаться как `Today`
  - в Notion фактически используется тег **`Inbox`** (алиас Today - Inbox)
- `Every Day`:
  - можно выбирать для периодических задач-напоминаний

## Инструменты (что реально используется)

- **Telegram polling**: получение апдейтов через `node-telegram-bot-api`.
- **Notion Tasks CRUD**: создание и чтение задач через Notion API (`core/connectors/notion`).
- **OpenAI**: анализ текста и выдача структурированного JSON для вопрос/задача и полей задачи.

## Запросы списков и работа с Notion (tools)

Если AI включен (`TG_AI=1`), бот умеет принимать естественные запросы вида:

- "покажи задачи"
- "покажи инбокс"
- "покажи домашние"
- "покажи задачи на сегодня"
- "пометь 3 как выполненную"
- "удали задачу X" (фактически переносит в `Deprecated`)

### Фильтры по умолчанию

- По умолчанию в списках **не показываются** выполненные задачи (`Done`).
- Выполненные показываются только если явно попросить:
  - "покажи выполненные" - покажет только `Done`
  - "покажи все включая выполненные" - покажет все статусы

### Подтверждение tool-действий

Для действий, которые меняют данные (например: пометить выполненным, перенести в Deprecated, обновить задачу, добавить описание) бот просит подтверждение:

- кнопками **Подтвердить** / **Отмена**
- или текстом (fallback): "да" / "нет"

### Синонимы категорий

- "инбокс", "входящие", "today" - категория `Inbox` (в UI может отображаться как `Today`)
- "домашние" - категория `Home`
- "рабочие", "работа" - категория `Work`

### "На сегодня"

- Фраза "задачи на сегодня" означает: задачи с due date = сегодня (по `TG_TZ`) плюс задачи из `Inbox`.

## Флаги запуска

- `TG_AI=1` - включает AI ветку.
- `TG_AI_MODEL=gpt-4.1-mini` - модель для AI.
- `TG_DEBUG=1` - включает `[tg_debug]` логи.


