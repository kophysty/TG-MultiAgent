# Voice режим (текущая реализация)

Этот раздел описывает текущий рабочий voice flow в боте.

## Как работает (v1)

Когда ты отправляешь voice в Telegram:

- бот берет `file_id`
- скачивает OGG/OPUS
- конвертирует через `ffmpeg` в `wav 16kHz mono PCM`
- отправляет wav в OpenAI Whisper (STT)
- получает текст
- прогоняет текст через AI планнер (tool calling)
  - если это вопрос - отвечает в чат
  - если нужен список или действие в Notion - вызывает Notion tools (list, find, update, done, deprecated, append description)
  - если это новая задача - показывает summary и просит подтверждение (кнопками или текстом)

## Статусы (UX)

Бот отправляет одно статус-сообщение и обновляет его через `editMessageText`:

- "Voice: скачиваю..."
- "Voice: конвертирую (ffmpeg)..."
- "Voice: распознаю (STT)..."
- "Voice: формирую задачу..."
- финально заменяет текст на: "Распознано: <одна строка...>"

Если редактирование статуса не удалось (например, удалили сообщение) - бот продолжит выполнение без падения.

## Переменные окружения

- `OPENAI_API_KEY` - ключ OpenAI (используется и для AI, и для STT).
- `TG_STT_MODEL` - модель STT (по умолчанию `whisper-1`).
- `TG_STT_LANGUAGE` - язык транскрипции (по умолчанию `ru`).
- `TG_TZ` - таймзона (по умолчанию `Europe/Moscow`), используется для интерпретации "на сегодня" и даты.

## Зависимости

- `ffmpeg-static` - бинарник ffmpeg, который вызывается из Node процесса.
- `form-data` - multipart upload для OpenAI STT endpoint.


