## Цель

- Упростить UX сохранения preferences и сделать его надежным.
- Добавить детерминированные админ-команды диагностики (Postgres preferences и активные модели).
- Устранить рассинхрон "какая модель используется" за счет явной настройки через env.

## Что сделано

### Preferences UX

- Текст подтверждения сохранения preferences стал короче: "Зафиксируем надежно это предпочтение?"
- Кнопки подтверждения заменены на "Да" и "Нет".
- Для сообщений с явным "запомни/сохрани" (включая voice транскрипт) бот теперь не дает LLM отвечать "Запомнил" без реального сохранения. Вместо этого сразу показывает подтверждение.
- Если extractor (LLM) не смог выделить структурированное preference, но команда явно про "запомни/в память", бот предлагает сохранить "сырой факт" как заметку (category `memory_note`) и сохраняет ее в Postgres после подтверждения.

### Админ-команды диагностики

- Добавлена команда `/prefs_pg` (admin only) - показывает preferences строго из Postgres по текущему чату.
- Добавлена команда `/model` (admin only) - показывает:
  - активные модели (AI, preferences extractor, STT)
  - включен ли AI (`TG_AI: on/off`)
  - есть ли ключ (`OPENAI_API_KEY: set/missing`)
  - подсказку по настройке.

### Управление моделью

- Добавлен алиас `AI_MODEL` к `TG_AI_MODEL` в todo bot (но предпочтительный способ - `TG_AI_MODEL`).
- Обновлена команда запуска в `.cursor/commands/restart-todo-bot.md` на `TG_AI_MODEL=gpt-5.1`.

## Файлы

- `core/dialogs/todo_bot.js`
- `core/dialogs/todo_bot_voice.js`
- `core/dialogs/todo_bot_callbacks.js`
- `docs/current/commands.md`
- `.cursor/commands/restart-todo-bot.md`
- `apps/todo_bot/package.json`
- `CHANGELOG.md`
- `HISTORY.md`
- `execution_history/index.md`

## Как проверить

1) В админ-чате отправить: `/model` и убедиться, что выводит ожидаемую модель (например `gpt-5.1`).
2) В админ-чате отправить: `/prefs_pg` и убедиться, что выводится список preferences из Postgres.
3) Отправить сообщение вида "Запомни, что ..." и убедиться, что бот спрашивает подтверждение "Зафиксируем надежно это предпочтение?" и показывает кнопки "Да/Нет".
4) Отправить сообщение вида "Запомни про соцсети: мы пишем в Facebook и Telegram" и убедиться, что вопрос в UI будет "Сохранить в память (заметка)?".

