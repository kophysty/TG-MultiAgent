# 2026-01-04 - Observability: event_log + trace_id (MVP)

## Цель

Добавить в Postgres таблицу `event_log` для безопасного (sanitized) трейсинга и начать протягивать `trace_id` по ключевым точкам пайплайна.

## Что сделано

- Postgres:
  - `infra/db/migrations/009_event_log.sql`
  - repo: `core/connectors/postgres/event_log_repo.js`
  - TTL purge: `EventLogRepo.purgeOld` (default `TG_EVENT_LOG_TTL_DAYS=90`)
- Sanitization:
  - добавлен `sanitizeForEventLog` (строже чем stdout логирование) в `core/runtime/log_sanitize.js`
- Trace id:
  - helper `core/runtime/trace.js` (генерация `trace_id`)
  - todo bot:
    - логирует `incoming_message` и `planner_plan` в `event_log`
    - логирует ошибки planner как `event=error`
  - callbacks:
    - логирует `incoming_callback` в `event_log`
  - reminders worker:
    - периодически чистит `event_log` по TTL
    - логирует `tick_error` в `event_log`

## Как применить миграцию

Внутри контейнера Postgres:

```bash
docker exec -i tg-multiagent-postgres psql -U tg_multiagent -d tg_multiagent < infra/db/migrations/009_event_log.sql
```

## Follow-ups

- Полная корреляция `trace_id` через notion и telegram outbound (и через executor) будет добавлена следующим шагом плана 06.


