# Sprint: Исправление валидации опций Notion и расширение датасета тестов
Дата: 2026-01-13
Версия: v0.2.8

## Что сделано
1. **Нормализация полей Notion**:
   - Во всех инструментах создания и обновления (Tasks, Ideas, Social Media Planner) добавлена нормализация полей `Status` и `Priority`.
   - Для Ideas также нормализованы `Category`, `Area`, `Tags` и `Project`.
   - Используется функция `pickBestOptionMatch`, которая сопоставляет ввод пользователя (или галлюцинации LLM) с реальными опциями из базы данных Notion.
   - Если опция не найдена и не является "авто-создаваемой" (как теги в определенных условиях), она отбрасывается (`undefined`), позволяя Notion использовать дефолтное значение базы или оставить поле пустым вместо выброса `HTTP 400 validation_error`.

2. **Изменения в репозиториях**:
   - Из `NotionTasksRepo`, `NotionIdeasRepo` и `NotionSocialRepo` удалены жестко заданные дефолты для статусов (`Idle`, `Inbox`, `Post Idea`). Теперь ответственность за дефолт лежит либо на базе Notion, либо на логике исполнителя (`todo_bot_executor.js`).

3. **Расширение датасета тестов**:
   - В `apps/evals/ds/03_2026-01-13_full_features.jsonl` добавлено 30 кейсов, покрывающих основные функции агента.
   - Добавлены "отравленные" кейсы (`f26`-`f30`) с несуществующими статусами, категориями и приоритетами для проверки устойчивости нормализации.

## Технические детали
- Файлы: `core/dialogs/todo_bot_executor.js`, `core/connectors/notion/*.js`.
- Версия бота поднята до `0.2.8`.
- Обновлены `CHANGELOG.md` и `HISTORY.md`.

## Результат
Бот стал более устойчив к ошибкам валидации Notion при несовпадении статусов, что критично для баз данных с кастомными настройками.

