# План: Подготовка и запуск комплексного тестирования (Evals & Executor)

**Дата:** 2026-01-13
**Цель:** Проверить работоспособность всех инструментов (Tasks, Ideas, Social, Journal) и интеграции с Postgres (Preferences) на реальных данных.

## 1. Сбор контекста и структуры

- [x] Изучена структура баз данных Notion через MCP:
- **Tasks Base**: Статусы (Idle, In work, Done), Теги (Work, Home, и т.д.), Приоритеты.
- **Ideas DB**: Категории (Concept, Research, и т.д.), Области (Dev, Business), Проекты.
- **Social Media Planner**: Платформы (TG, FB, и т.д.), Типы контента, Статусы.
- **Journal**: Типы (Мысль, Итог дня), Настроение (1-5), Энергия (1-5).
- [x] Изучена структура Postgres (Preferences, Chat Memory).

## 2. Подготовка датасета Planner (LLM)

Создать новый файл `apps/evals/ds/03_2026-01-13_full_features.jsonl` со следующими сценариями:

### Домен: Задачи (Tasks)

- Создание с полным набором полей (дата, время, приоритет, тег).
- Массовое удаление/завершение ("закрой задачи 1, 2 и 3", "удали задачи про молоко и хлеб").
- Поиск и фильтрация ("найди задачи по работе", "покажи выполненные за вчера").

### Домен: Идеи (Ideas)

- **Кейс пользователя**: "добавь идею клавиатура с встроенным микрофоном для обвайп кодеров в раздел Dev с тегом Hardware".
- Обновление полей (смена статуса на Active, добавление проекта).
- Поиск по ключевым словам.

### Домен: Соцсети (Social)

- Создание поста для конкретной платформы (например, LinkedIn).
- Планирование на неделю ("покажи график постов на эту неделю").
- Смена статуса (Draft -> Scheduled -> Published).

### Домен: Дневник (Journal)

- Создание записи с автоматическим определением настроения/энергии ("день был тяжелый, но продуктивный").
- Поиск записей ("что я писал про стартап на прошлой неделе?").

### Домен: Настройки (Postgres)

- Извлечение предпочтений ("запомни, что я не люблю длинные ответы").

## 2.1. Adversarial кейсы (ломающие флоу)

Добавить отдельный блок в датасет, который проверяет устойчивость к:

- Невалидным options Notion (Status, Priority, Category, Platform, Content type) - например `New`, `Ultra`, `Secret`, `UnknownPlatform`.
- Невалидным датам и времени - например `32.13.2026`, `2026-99-99`, "завтра в 25:90".
- Странным и "шумным" входам - эмодзи, кавычки, инъекции типа `'; DROP TABLE ...; --` в queryText.
- Пограничным ссылкам на элементы списков - большие индексы, отсутствие контекста (без lastShownList).

## 3. Сценарии тестирования Executor (Реальная БД)

Подготовить набор интеграционных тестов (или ручной чек-лист), которые проверяют:

- **Создание**: Появление записи в нужной базе Notion с правильными Properties.
- **Обновление**: Корректное изменение Select/Multi-select полей (без дублирования опций, если это не предусмотрено).
- **Удаление**: Перенос в "Deprecated" (для задач) или "Archived" (для идей/соцсетей).
- **Синхронизация Postgres**: Сохранение предпочтений в таблицу `preferences` после фразы пользователя.

## 4. Ожидаемые результаты

- Отчет `data/evals/report-2026-01-13-*.json` показывает 100% mismatch = 0.
- Все тестовые записи успешно созданы в Notion и Postgres и удалены/архивированы в конце теста.